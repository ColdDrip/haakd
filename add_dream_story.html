

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DREAMER</title>
  <!--JQUERY-->
  <script src="https://code.jquery.com/jquery-3.1.0.js" integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"   integrity="sha256-0YPKAwZP7Mp3ALMRVB2i8GXeEndvCq3eSl/WsAl1Ryk="   crossorigin="anonymous"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="js/show_orbs.js"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="add_dream.css">
  <link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah|Open+Sans:300" rel="stylesheet">
</head>

<body>

    <div class="container-fluid">
        <div class="row">
            <nav class="navbar-fixed-top">
                <div id="dreamer"><a href="index.html">dreamer.</a></div>
            </nav>
        </div>

  <div id= "image_section">
		<div class="row margin-top">
		<div class="row orb-margin2">
			<form action="lib/add_dream_story.php" method="post" name="addnewdream" enctype="multipart/form-data" id="newDreamForm">

			<label for="Story" class="col-xs-12 text-center">Describe a dream that you had:</label>
		</div>

			<div class="col-md-4 col-md-offset-4">
				<textarea rows="5" cols="50" name="Story" id="Story" class="orb-margin"></textarea>
				<div class="large_triangle orb-margin"></div>
			</div>
			<!--Emotion Control-->
			<div class="col-md-4 emotion-control">
				<label for="Emotion">Emotion:</label>
				<select name="Emotion" id="Emotion" >
          <option name="Not Sure" value="Not Sure">Not Sure</option>
					<option name="Joy" value="Joy">Joy</option>
					<option name="Surprise" value="Surprise">Surprise</option>
					<option name="Anger" value="Anger">Anger</option>
					<option name="Fear" value="Fear">Fear</option>
					<option name="Sadness" value="Sadness">Sadness</option>
					<option name="Disgust" value="Disgust">Disgust</option>
				</select>
			</div>
		</div>
			<div class="row margin-top margin-bottom">
			<!-- Back Button-->
				<div class="col-md-2 col-md-offset-2">
					<a href="index.html" id="back">	&lt;&lt; back</a>
				</div>
				<!-- Next Button-->
				<input type="submit" id="newDreamSubmit" value="next &gt;&gt;"
				class="col-md-2 col-md-offset-4 text-right"data-dismiss="modal">


			</form>
			</div>
</div>
	</div>	<!--End of Container-->

  <!--Searching Trove Inputs-->
<div id="picture_stuff">
  <div class="col-md-6 ">
    <div class="row">
      <div class="searchbox col-md-6 orb-margin">
      <form action="#" id="searchTrove">
        <input id="searchTerm" type="text" class="col-md-7" />
        <button type="submit" id="searchbtn" class="col-md-3">Search</button>
      </form>
      </div>
    </div>


    <!--Image holders-->
    <div class="row">
      <div class="col-md-2 orb-margin">
      <!--Change Image-->
      <a href="#" id="changeImages1"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></a>
      <div id="output1"></div>
      </div>
    </div>
    <!--Change Image-->
    <div class="row">
      <div class="col-md-2 orb-margin">
      <a href="#" id="changeImages2"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></a>
      <div id="output2"></div>
      </div>
    </div>

    <!--Confirming the imgaes-->
  </div>



<div class="row margin-top">
  <div class="col-md-4 col-md-offset-8 text-left">
  <form action="lib/add_dream_images.php" method="post" name="addimages" enctype="multipart/form-data" id="newDreamImageForm">
    <input type="hidden" name="Image_Path_1" id="Image_Path_1" value="" />
    <input type="hidden" name="Image_Path_2" id="Image_Path_2" value="" />
    <input type="submit" id="newDreamImageSubmit" value="Submit Dream &gt;&gt;" data-dismiss="modal">
  </form>
</div>
</div>
</div>
<div class="row">
  <footer></footer>
</div>
</div>
</div>



<script type="text/JavaScript">


document.getElementById('picture_stuff').style.display = "none"




var loadedImages = [];
var selectImages =[];

var urlPatterns = ["flickr.com", "nla.gov.au", "artsearch.nga.gov.au", "recordsearch.naa.gov.au", "images.slsa.sa.gov.au"];
var found = 0;
(function($){

  $("#newDreamSubmit").click(function changeImages(event) {
  document.getElementById('image_section').style.display = "none"
 
}

  $("form#searchTrove").submit(function searchTrove(event) {
    event.preventDefault();




    loadedImages = [];
    var url1;
    var url2;


    //get input values
    var searchTerm = $("#searchTerm").val().trim();
    searchTerm = searchTerm.replace(/ /g, "%20");
    var sortBy = $("#sortBy").val();
    var apiKey = "h6qpbr12thbbd2r7";

    //create searh query
    var url = "http://api.trove.nla.gov.au/result?key=" + apiKey + "&l-availability=y%2Ff&l-format=Art+work&encoding=json&zone=picture" + "&sortby=relevance&n=100&q=" + searchTerm + "&callback=?";




    //get the JSON information we need to display the images
    $.getJSON(url, function(data) {
      $('#output1').empty();
      $('#output2').empty();

      console.log(data);
      console.log(loadedImages.length);

      $.each(data.response.zone[0].records.work, processImages);
      var imageNum = Math.floor((Math.random()*loadedImages.length));
      var imageNum2 = imageNum + 1;

      console.log(loadedImages.length);
      console.log("first search image1-1",imageNum);
      console.log("first search image2-2",imageNum2);


      updateURL(imageNum,imageNum2);
      printImages();

      //when refreshing image1
      $("a#changeImages1").click(function changeImages(event) {
        event.preventDefault();
        $('#output1').empty();

        imageNum = Math.floor((Math.random()*loadedImages.length));
        if (imageNum == imageNum2){
          imageNum = imageNum + 1;
          console.log("change1-image1",imageNum);
          console.log("change1-image2",imageNum2);
          printImages();
        }else{
          console.log("change1-1-image1",imageNum);
          console.log("change1-1-image2",imageNum2);
          updateURL(imageNum,imageNum2);
          printImages();

        }

      });


      //when refreshing image2
      $("a#changeImages2").click(function changeImages2(event) {
        event.preventDefault();
        $('#output2').empty();
        imageNum2 = Math.floor((Math.random()*loadedImages.length));
        if (imageNum == imageNum2){
          imageNum2 = imageNum2+1;
          console.log("change2-image1",imageNum);
          console.log("change2-image2",imageNum2);
          printImages();
        }else{
          console.log("change2-1-image1",imageNum);
          console.log("change2-1-image2",imageNum2);
          updateURL(imageNum,imageNum2);
          printImages();
        }
      });
    });
  });
  //add two images URL into array and print them out
  function updateURL(imageNum,imageNum2){
    url1 = loadedImages[imageNum];
    url2 = loadedImages[imageNum2];
    var Image_Path_1 = url1;
    var Image_Path_2 = url2;
    console.log(Image_Path_1);
    console.log(Image_Path_2);
    document.getElementById('Image_Path_1').value = Image_Path_1;
    document.getElementById('Image_Path_2').value = Image_Path_2;
  }

  function processImages(index, troveItem) {

    var imgUrl = troveItem.identifier[0].value;
    if (imgUrl.indexOf(urlPatterns[0]) >= 0) { // flickr
      found++;
      addFlickrItem(imgUrl, troveItem);

    } else if (imgUrl.indexOf(urlPatterns[1]) >= 0) { // nla.gov
      found++;
      loadedImages.push(
        imgUrl + "/representativeImage?wid=900" // change ?wid=900 to scale the image
      );

    } else if (imgUrl.indexOf(urlPatterns[2]) >= 0) { //artsearch
      found++;
      loadedImages.push(
        "http://artsearch.nga.gov.au/IMAGES/LRG/" + getQueryVariable("IRN", imgUrl) + ".jpg"
      );

    } else if (imgUrl.indexOf(urlPatterns[3]) >= 0) { //recordsearch
      found++;
      loadedImages.push(
        "http://recordsearch.naa.gov.au/NAAMedia/ShowImage.asp?T=P&S=1&B=" + getQueryVariable("Number", imgUrl)
      );

    } else if (imgUrl.indexOf(urlPatterns[4]) >= 0) { //slsa
      found++;
      loadedImages.push(
        imgUrl.slice(0, imgUrl.length - 3) + "jpg"
      );


    } else {

    }
  }

  function addFlickrItem(imgUrl, troveItem) {
    var flickr_key = "a4d0bf2f4bde0595521b7bd8317ec428";
    var flickr_secret = "efc7221b694ff55e";
    var flickr_url = "https://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key=" + flickr_key + "&photo_id=";
    var url_comps = imgUrl.split("/");
    var photo_id = url_comps[url_comps.length - 1];

    $.getJSON(flickr_url + photo_id + "&format=json&nojsoncallback=1", function(data) {
      if (data.stat == "ok") {
        var flickr_image_url = data.sizes.size[data.sizes.size.length - 1].source;
        loadedImages.push(
          flickr_image_url
        );
      }
    });

  }

  function printImages() {

    //$("#output").append("<h3>Image Search Results</h3>");

    // Print out all images

    var image1 = new Image();
    image1.src = url1;
    image1.style.display = "inline-block";
    image1.style.width = "100%";
    image1.style.margin = "1%";
    image1.style.verticalAlign = "middle";
    $("#output1").append(image1);

    var image2 = new Image();
    image2.src = url2;
    image2.style.display = "inline-block";
    image2.style.width = "100%";
    image2.style.margin = "1%";
    image2.style.verticalAlign = "middle";

    $("#output2").append(image2);

  }

  // from http://css-tricks.com/snippets/javascript/get-url-variables/
  function getQueryVariable(variable, url) {
    var query = url.split("?");
    var vars = query[1].split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      if (pair[0] == variable) {
        return pair[1];
      }
    }
    return (false);
  }

}(jQuery));

</script>

	<div class="container">
	<footer class="footer"><div></div></footer>
</div>
	<script src="js.js"></script>
</body>
</html>
